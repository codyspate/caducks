---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Sign Up - California Ducks">
    <main
        class="flex min-h-[calc(100vh-4rem)] items-start md:items-center justify-center p-4"
    >
        <div
            class="w-full max-w-md bg-neutral-900 border border-neutral-800 rounded-xl shadow-2xl p-8"
        >
            <h1
                class="text-3xl font-bold text-center mb-2 font-serif text-neutral-100"
            >
                Create an Account
            </h1>
            <p class="text-neutral-500 text-center mb-8">
                Join the California Ducks community
            </p>

            <form id="signup-form" class="space-y-5">
                <div>
                    <label for="name" class="form-label">Full Name</label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        required
                        class="input-field"
                        placeholder="John Doe"
                    />
                </div>
                <div>
                    <label for="email" class="form-label">Email address</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        required
                        class="input-field"
                        placeholder="you@example.com"
                    />
                </div>
                <div>
                    <label for="password" class="form-label">Password</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        required
                        class="input-field"
                        placeholder="••••••••"
                    />
                </div>

                <button
                    type="submit"
                    id="submit-btn"
                    class="w-full btn-primary py-2.5 px-4"
                >
                    Create Account
                </button>
            </form>

            <p class="mt-8 text-center text-sm text-neutral-500">
                Already have an account?
                <a
                    href="/signin"
                    class="text-amber-500 hover:text-amber-400 font-medium transition-colors"
                    >Sign in</a
                >
            </p>
        </div>
    </main>
</Layout>

<script>
    import { authClient } from "../lib/auth-client";

    const form = document.getElementById("signup-form") as HTMLFormElement;
    const submitBtn = document.getElementById(
        "submit-btn",
    ) as HTMLButtonElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = (document.getElementById("name") as HTMLInputElement)
            .value;
        const email = (document.getElementById("email") as HTMLInputElement)
            .value;
        const password = (
            document.getElementById("password") as HTMLInputElement
        ).value;

        try {
            submitBtn.textContent = "Creating account...";
            submitBtn.disabled = true;

            const { data, error } = await authClient.signUp.email({
                email,
                password,
                name,
                callbackURL: "/",
            });

            if (error) {
                alert(error.message);
                submitBtn.textContent = "Create Account";
                submitBtn.disabled = false;
                return;
            }

            // Redirect on success
            window.location.href = "/";
        } catch (err) {
            console.error(err);
            submitBtn.textContent = "Create Account";
            submitBtn.disabled = false;
        }
    });
</script>
